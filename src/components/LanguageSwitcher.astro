---
import { languageTag } from '../paraglide/runtime';

const languages = [
  { code: 'en', label: 'EN', flag: 'ðŸ‡ºðŸ‡¸' },
  { code: 'es', label: 'ES', flag: 'ðŸ‡²ðŸ‡½' },
  { code: 'zh-CN', label: 'ç®€ä¸­', flag: 'ðŸ‡¨ðŸ‡³' },
  { code: 'zh-TW', label: 'ç¹ä¸­', flag: 'ðŸ‡¹ðŸ‡¼' },
  { code: 'pt', label: 'PT', flag: 'ðŸ‡§ðŸ‡·' },
];

const localePattern = new RegExp(`^/(${languages.map((lang) => lang.code).join('|')})(?=/|$)`);
const pathWithoutLocale = Astro.url.pathname.replace(localePattern, '');
const normalizedPath = pathWithoutLocale === '' ? '/' : pathWithoutLocale;
const buildHref = (code) => `${code === 'en' ? '' : `/${code}`}${normalizedPath}`;
---

<div class="flex items-center gap-2 glass rounded-full px-3 py-1.5">
  {languages.map((lang) => (
    <a
      href={buildHref(lang.code)}
      class:list={[
        'px-2 py-1 rounded text-xs font-medium transition-colors',
        languageTag() === lang.code
          ? 'bg-snf-blue-500 text-white'
          : 'text-snf-white/60 hover:text-snf-white',
      ]}
      aria-current={languageTag() === lang.code ? 'page' : undefined}
    >
      <span class="mr-1" aria-hidden="true">{lang.flag}</span>
      <span>{lang.label}</span>
    </a>
  ))}
</div>
