---
import { languageTag } from '../paraglide/runtime';

const languages = [
  { code: 'en', label: 'EN', flags: ['ðŸ‡ºðŸ‡¸', 'ðŸ‡¬ðŸ‡§'] },
  { code: 'es', label: 'ES', flags: ['ðŸ‡ªðŸ‡¸', 'ðŸ‡²ðŸ‡½', 'ðŸ‡¦ðŸ‡·', 'ðŸ‡¨ðŸ‡·'] },
  { code: 'zh-CN', label: 'ç®€ä¸­', flags: ['ðŸ‡¨ðŸ‡³', 'ðŸ‡¸ðŸ‡¬'] },
  { code: 'pt', label: 'PT', flags: ['ðŸ‡§ðŸ‡·', 'ðŸ‡µðŸ‡¹'] },
  { code: 'uk', label: 'Ð£Ðš', flags: ['ðŸ‡ºðŸ‡¦'] },
  { code: 'ru', label: 'Ð Ð£', flags: ['ðŸ‡·ðŸ‡º', 'ðŸ‡§ðŸ‡¾', 'ðŸ‡°ðŸ‡¿'] },
];

const localePattern = new RegExp(`^/(${languages.map((lang) => lang.code).join('|')})(?=/|$)`);
const pathWithoutLocale = Astro.url.pathname.replace(localePattern, '');
const normalizedPath = pathWithoutLocale === '' ? '/' : pathWithoutLocale;
const buildHref = (code) => `${code === 'en' ? '' : `/${code}`}${normalizedPath}`;
---

<div class="flex items-center gap-1 flex-wrap justify-center">
  {languages.map((lang) => (
    <a
      href={buildHref(lang.code)}
      class:list={[
        'px-2 py-1.5 rounded-full text-xs font-medium transition-all duration-200 inline-flex items-center gap-1',
        languageTag() === lang.code
          ? 'bg-snf-white/10 text-snf-white'
          : 'text-snf-white/40 hover:text-snf-white/80 hover:bg-snf-white/5',
      ]}
      aria-current={languageTag() === lang.code ? 'page' : undefined}
      title={lang.flags.length > 1 ? `${lang.label} - Multiple regions` : lang.label}
    >
      <span class="text-[9px] flex gap-px" aria-hidden="true">
        {lang.flags.map((flag) => <span>{flag}</span>)}
      </span>
      <span>{lang.label}</span>
    </a>
  ))}
</div>
