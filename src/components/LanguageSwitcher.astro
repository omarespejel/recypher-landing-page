---
import { languageTag } from '../paraglide/runtime';

const languages = [
  { code: 'en', label: 'EN', nativeName: 'English' },
  { code: 'es', label: 'ES', nativeName: 'Español' },
  { code: 'pt', label: 'PT', nativeName: 'Português' },
  { code: 'zh-CN', label: '简', nativeName: '简体中文' },
  { code: 'zh-TW', label: '繁', nativeName: '繁體中文' },
  { code: 'ar', label: 'ع', nativeName: 'العربية' },
  { code: 'uk', label: 'UK', nativeName: 'Українська' },
  { code: 'ru', label: 'RU', nativeName: 'Русский' },
];

const localePattern = new RegExp(`^/(${languages.map((lang) => lang.code).join('|')})(?=/|$)`);
const pathWithoutLocale = Astro.url.pathname.replace(localePattern, '');
const normalizedPath = pathWithoutLocale === '' ? '/' : pathWithoutLocale;
const buildHref = (code) => `${code === 'en' ? '' : `/${code}`}${normalizedPath}`;
---

<div class="flex items-center gap-0.5 bg-snf-white/5 rounded-lg p-0.5">
  {languages.map((lang) => (
    <a
      href={buildHref(lang.code)}
      class:list={[
        'px-2 py-1 rounded-md text-[11px] font-medium transition-all duration-200',
        languageTag() === lang.code
          ? 'bg-snf-blue-500 text-white'
          : 'text-snf-white/50 hover:text-snf-white hover:bg-snf-white/10',
      ]}
      aria-current={languageTag() === lang.code ? 'page' : undefined}
      title={lang.nativeName}
    >
      {lang.label}
    </a>
  ))}
</div>
