---
import { languageTag } from '../paraglide/runtime';

const languages = [
  { code: 'en', label: 'EN', flag: 'ðŸ‡ºðŸ‡¸' },
  { code: 'es', label: 'ES', flag: 'ðŸ‡ªðŸ‡¸' },
  { code: 'zh-CN', label: 'ç®€ä¸­', flag: 'ðŸ‡¨ðŸ‡³' },
  { code: 'pt', label: 'PT', flag: 'ðŸ‡§ðŸ‡·' },
  { code: 'uk', label: 'Ð£Ðš', flag: 'ðŸ‡ºðŸ‡¦' },
  { code: 'ru', label: 'Ð Ð£', flag: 'ðŸ‡·ðŸ‡º' },
];

const localePattern = new RegExp(`^/(${languages.map((lang) => lang.code).join('|')})(?=/|$)`);
const pathWithoutLocale = Astro.url.pathname.replace(localePattern, '');
const normalizedPath = pathWithoutLocale === '' ? '/' : pathWithoutLocale;
const buildHref = (code) => `${code === 'en' ? '' : `/${code}`}${normalizedPath}`;
---

<div class="flex items-center gap-1">
  {languages.map((lang) => (
    <a
      href={buildHref(lang.code)}
      class:list={[
        'px-2.5 py-1.5 rounded-full text-xs font-medium transition-all duration-200',
        languageTag() === lang.code
          ? 'bg-snf-white/10 text-snf-white'
          : 'text-snf-white/40 hover:text-snf-white/80 hover:bg-snf-white/5',
      ]}
      aria-current={languageTag() === lang.code ? 'page' : undefined}
    >
      <span class="mr-0.5 text-[10px]" aria-hidden="true">{lang.flag}</span>
      <span>{lang.label}</span>
    </a>
  ))}
</div>
